const re=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const f of n.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function i(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerpolicy&&(n.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?n.credentials="include":l.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(l){if(l.ep)return;l.ep=!0;const n=i(l);fetch(l.href,n)}};re();const k=e=>{const o=e.x*e.x+e.y*e.y,i=Math.sqrt(o);return{x:e.x/i,y:e.y/i}},j=(e,o)=>{const i=o.position.x-o.size.x/2,s=o.position.x+o.size.x/2,l=o.position.y-o.size.y/2,n=o.position.y+o.size.y/2,f=Math.min(s,Math.max(i,e.position.x)),R=Math.min(n,Math.max(l,e.position.y)),h={x:f-e.position.x,y:R-e.position.y};let _=Math.sqrt(h.x*h.x+h.y*h.y);const $=k(h);return Number.isNaN($.x)&&(_=0,console.log("nan",h)),_<e.radius?{direction:$,amount:e.radius-_,point:h}:!1},ce=(e,o)=>!(e.position.x+e.size.x/2<o.position.x-o.size.x||o.position.x+o.size.x/2<e.position.x-e.size.x||e.position.y+e.size.y/2<o.position.y-o.size.y||o.position.y+o.size.y/2<e.position.y-e.size.y),ie=e=>{const o=Uint8Array.from(atob(e),i=>i.charCodeAt(0));if(o.length!==256)throw new Error("Custom level must contain 256 elements");return o},fe=e=>btoa(String.fromCharCode.apply(null,Array.from(e))),ae=(e=1)=>{const o=k({x:Math.random()-.5,y:Math.random()-.5});return o.x*=e,o.y*=e,o};class ye{position={x:0,y:0};velocity=ae(1+Math.random()*30);accelleration={x:0,y:0};lifeSpan=1e3;created=Date.now();size=2+Math.floor(Math.random()*10);color="#fff";constructor(o,i,s){this.position=o??this.position,this.velocity=i??this.velocity,this.accelleration=s??this.accelleration}render(o){o.fillStyle=this.color,o.fillRect(this.position.x-this.size/2,this.position.y-this.size/2,this.size,this.size)}update(o){this.position.x+=this.velocity.x*o/1e3,this.position.y+=this.velocity.y*o/1e3,this.position.y+=50*o/1e3}}var y=(e=>(e[e.PAD_SIZE=0]="PAD_SIZE",e[e.EXTRA_BALL=1]="EXTRA_BALL",e[e.STICKY_PAD=2]="STICKY_PAD",e[e.SHIELD=3]="SHIELD",e[e.MEGABALL=4]="MEGABALL",e))(y||{}),x=(e=>(e[e.MENU=0]="MENU",e[e.GAME=1]="GAME",e[e.DEFEAT=2]="DEFEAT",e[e.VICTORY=3]="VICTORY",e[e.LEVELEDITOR=4]="LEVELEDITOR",e))(x||{});const K=new AudioContext,oe=new FontFace("visitor","url(./visitor1.ttf");await oe.load();document.fonts.add(oe);const de=await Promise.all(["test_10.wav","test_11.wav","test_12.wav"].map(async e=>{try{const i=await(await fetch(e)).arrayBuffer();return K.decodeAudioData(i)}catch(o){throw o}})),xe=await Promise.all(["brick_dmg_1.png","brick_dmg_2.png"].map(async e=>new Promise((o,i)=>{const s=new Image;s.src=e,s.onload=()=>{o(s)},s.onerror=l=>{i(l)}}))),L=(e=0)=>{const o=de[e];if(!o)return;const i=K.createBufferSource();i.buffer=o,i.connect(K.destination),i.start()},u=document.querySelector("canvas"),t=u.getContext("2d");t.imageSmoothingEnabled=!1;const d=800,a=600,w={x:50,y:25},V=1e3/400,F=V/1e3,pe=12,ue=1;let S=1,J=Date.now(),H=0,v=F/S;const U=new Map,C=new Map,m={GREEN:"#27ae61",BLUE:"#297fb8",PURPLE:"#8d44ad",DARK_BLUE:"#34495e",GRAY:"#bec3c7",RED:"#c1392b",YELLOW:"#f39c11",TEAL:"#16a086"},g=Object.values(m),he="#f1c40f";let Y=400,G=800,Ee=200;const me=12e3,Le=8e3;let p=[],B=[],M=[],c={position:{x:d/2,y:a-40},size:{x:100,y:12}},z=[],N=3,b=!1,I=null,T=!1,P=null,X=!1;const A=[];let E=x.MENU,Z=!0;const se=()=>{const e=Date.now(),o=e-J;if(J=e,Z)switch(E){case x.MENU:ge(),Me();break;case x.GAME:H+=o,Se(o),ve();break;case x.DEFEAT:Re(),we();break;case x.VICTORY:ke(),ze();break;case x.LEVELEDITOR:Te(),_e();break}t.font="40px visitor",t.textAlign="left",t.textBaseline="top",t.fillStyle="#fff",C.clear(),r.pressed=!1,window.requestAnimationFrame(se)},Se=e=>{for(;H>=V;)H-=V,Ae();const o=Date.now();for(let i=0;i<A.length;i++)o-A[i].created>A[i].lifeSpan?(A.splice(i,1),i--):A[i].update(e);if(I!=null&&Date.now()-I>=me&&(I=null,b=!1),P!=null&&Date.now()-P>=Le&&(P=null,T=!1),T){for(const i of p)if(Math.random()<.3){const s=new ye({x:i.position.x+(Math.random()-.5)*i.radius,y:i.position.y+(Math.random()-.5)*i.radius}),l=Math.random();l<.5?s.color=m.RED:l<.85?s.color=m.YELLOW:s.color=m.PURPLE,A.push(s)}}},Ae=()=>{(O("ArrowLeft")||O("KeyA"))&&(c.position.x-=G*v),(O("ArrowRight")||O("KeyD"))&&(c.position.x+=G*v),c.position.x-c.size.x/2<0?c.position.x=c.size.x/2:c.position.x+c.size.x/2>d&&(c.position.x=d-c.size.x/2);const e=[];for(const i of p){i.stuck?i.position.x=c.position.x+i.stuckPosition:(i.position.x+=i.velocity.x*Y*v,i.position.y+=i.velocity.y*Y*v);let s=!1,l=!1;for(const n of B.concat(M)){if(n.dead)continue;const f=j(i,n);f&&(L(1),T?(n.health=0,te(n)):(console.log(n),n.maxHealth&&(n.health-=1,n.health===0&&te(n)),Math.abs(f.direction.x)>Math.abs(f.direction.y)?s=!0:l=!0))}{const n=j(i,c);if(n){i.position.x-=n.amount*n.direction.x,i.position.y-=n.amount*n.direction.y;const f=i.position.x-c.position.x,R=f/c.size.x;b?(i.stuck=!0,i.stuckPosition=f,i.velocity=k({x:R*3,y:-1})):(i.velocity=k({x:i.velocity.x+R,y:i.velocity.y}),L(2),Math.abs(n.direction.x)>Math.abs(n.direction.y)?s=!0:l=!0)}}s&&(i.velocity.x*=-1),l&&(i.velocity.y*=-1),(s||l)&&(Y+=2),i.position.x-i.radius/2<=0?(i.position.x=0+i.radius/2,i.velocity.x*=-1,L(2)):i.position.x+i.radius/2>=d&&(i.position.x=d-i.radius/2,i.velocity.x*=-1,L(2)),i.position.y-i.radius/2<=0&&(i.position.y=0+i.radius/2,i.velocity.y*=-1,L(2)),i.position.y<a+i.radius&&e.push(i)}p=e,!X&&!p.length&&(N===0?(E=x.DEFEAT,L(0)):(N--,L(0),X=!0,M=[],z=[],setTimeout(()=>{ne(),X=!1},200))),B.some(i=>i.maxHealth>0&&i.health>0)||(E=x.VICTORY);const o=[];for(const i of z)if(i.position.y+=Ee*v,ce(c,i))if(i.type===y.PAD_SIZE)c.size.x=Math.min(c.size.x+20,260);else if(i.type===y.EXTRA_BALL){const s=p[Math.floor(Math.random()*p.length)];p.push({position:{x:s.position.x,y:s.position.y},radius:s.radius,stuck:s.stuck,stuckPosition:s.stuckPosition,velocity:k({x:s.velocity.x+(.2+Math.random()*.8)*(Math.random()<.5?-1:1)*.2,y:s.velocity.y})})}else if(i.type===y.STICKY_PAD)b=!0,I=Date.now();else if(i.type===y.SHIELD){M=[];for(let s=0;s<16;s++){const l={size:{x:50,y:20},position:{x:s*50+25,y:a},maxHealth:1,health:1,color:4,dead:!1,power:void 0};M.push(l)}}else i.type===y.MEGABALL&&(T=!0,P=Date.now());else o.push(i);z=o},ve=()=>{t.fillStyle="#000",t.fillRect(0,0,u.width,u.height),t.fillStyle="#999",t.textAlign="left",t.textBaseline="bottom",t.fillText(`LIVES ${N}`,15,a-10);for(const e of B){if(e.dead)continue;t.fillStyle=g[e.color],t.fillRect(e.position.x-e.size.x/2+1,e.position.y-e.size.y/2+1,e.size.x-2,e.size.y-2);const o=e.maxHealth-e.health;o&&t.drawImage(xe[o-1],e.position.x-e.size.x/2,e.position.y-e.size.y/2)}for(const e of M)e.health&&(t.fillStyle=m.GRAY,t.fillRect(e.position.x-e.size.x/2+1,e.position.y-e.size.y/2+1,e.size.x-2,e.size.y-2));for(const e of z){e.type===y.PAD_SIZE?t.fillStyle="#60dee6":e.type===y.EXTRA_BALL?t.fillStyle="#72e653":t.fillStyle="#fff32b",t.fillStyle=he,t.fillRect(e.position.x-e.size.x/2,e.position.y-e.size.y/2,e.size.x,e.size.y),t.textAlign="center",t.textBaseline="middle";let o="?";e.type===y.EXTRA_BALL?o="B":e.type===y.PAD_SIZE?o="P":e.type===y.STICKY_PAD?o="S":e.type===y.SHIELD?o="D":e.type===y.MEGABALL&&(o="M"),t.lineWidth=5,t.strokeStyle="#000",t.strokeText(o,e.position.x,e.position.y),t.fillStyle="#fff",t.fillText(o,e.position.x,e.position.y)}t.fillStyle="#fff",T&&(t.fillStyle="orange");for(const e of p)t.beginPath(),t.arc(e.position.x,e.position.y,e.radius,0,Math.PI*2),t.closePath(),t.fill();t.fillStyle="#fff",t.fillRect(c.position.x-c.size.x/2,c.position.y-c.size.y/2+1,c.size.x,c.size.y),b&&(t.fillStyle=m.YELLOW,t.fillRect(c.position.x-c.size.x/2,c.position.y-c.size.y/2,c.size.x,4));for(const e of A)e.render(t)},ge=()=>{C.get("Space")&&(E=x.GAME,N=3,le())},Me=()=>{t.fillStyle="#000",t.fillRect(0,0,d,a),t.fillStyle="#fff",t.font="120px visitor",t.textAlign="center",t.fillText("BREAKOUT",d/2,a/2-100),t.textAlign="left",t.font="40px visitor",t.fillText("[Space] - start       ",200,a/2+20),t.fillText("    [L] - level editor",200,a/2+50)},Re=()=>{C.get("Space")&&(E=x.MENU)},we=()=>{t.fillStyle="#000",t.fillRect(0,0,d,a),t.fillStyle="#fff",t.font="120px visitor",t.textAlign="center",t.fillText("defeat",d/2,a/2-100),t.font="40px visitor",t.fillText("Press [Space] to go to menu",d/2,a/2)},ke=()=>{C.get("Space")&&(E=x.MENU)},ze=()=>{t.fillStyle="#000",t.fillRect(0,0,d,a),t.fillStyle="#fff",t.font="120px visitor",t.textAlign="center",t.fillText("victory",d/2,a/2-100),t.font="40px visitor",t.fillText("Press [Space] to go to menu",d/2,a/2)},r={x:0,y:0,down:!1,pressed:!1};let D=new Uint8Array(256).fill(255);const De=new URLSearchParams(location.search),Q=De.get("level");if(Q)try{D=ie(Q)}catch{}let W=0,q=1;const Te=()=>{const e=Math.floor(r.x/(u.clientWidth/16)),o=Math.floor(r.y/(u.clientWidth/32));r.down&&e>=0&&e<=15&&o>=0&&o<=15&&(W===g.length?D[o*16+e]=255:D[o*16+e]=W|q<<3);for(let i=0;i<=g.length;i++){let s=200+i*60,l=430;r.pressed&&r.x>=s&&r.x<=s+50&&r.y>=l&&r.y<=l+25&&(W=i)}for(let i=0;i<=3;i++){let s=200+i*60,l=480;r.pressed&&r.x>=s&&r.x<=s+50&&r.y>=l&&r.y<=l+25&&(q=i)}},_e=()=>{t.fillStyle="#000",t.fillRect(0,0,d,a),t.strokeStyle="#fff",t.fillStyle="#222",t.lineWidth=1;for(let i=0;i<=16;i++)t.fillRect(0,i*25,d,2),t.fillRect(i*50-1,0,2,16*25);t.font="30px visitor",t.textAlign="center",t.textBaseline="middle";for(let i=0;i<16;i++)for(let s=0;s<16;s++){const l=D[i*16+s];if(l!==255){const n=7&l,f=(24&l)>>3;t.fillStyle=g[n],t.fillRect(s*50+1,i*25+1,50-2,25-2),t.fillStyle="#fff",t.fillText(`${f}`,s*50+25,i*25+12)}}const e=Math.floor(r.x/(u.clientWidth/16)),o=Math.floor(r.y/(u.clientWidth/32));e>=0&&e<=15&&o>=0&&o<=15&&(t.setLineDash([5,5]),t.lineWidth=2,t.strokeRect(e*50,o*25,50,25)),t.textBaseline="middle",t.textAlign="left",t.fillStyle="#fff",t.fillText("color",25,440),t.fillText("health",25,490);for(let i=0;i<=g.length;i++){t.setLineDash([]),t.lineWidth=2;let s=200+i*60,l=430;W===i?t.strokeStyle="#fff":r.x>=s&&r.x<=s+50&&r.y>=l&&r.y<=l+25?t.strokeStyle="#ddd":t.strokeStyle="#0000",t.strokeRect(s,l,50,25),i<g.length?(t.fillStyle=g[i],t.fillRect(s,l,50,25)):(t.strokeStyle="#fff",t.lineWidth=2,t.setLineDash([5,5]),t.strokeRect(s,l,50,25),t.beginPath(),t.moveTo(s+10,l+10),t.lineTo(s+50-10,l+25-10),t.closePath(),t.setLineDash([]),t.stroke())}t.font="30px visitor",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#fff";for(let i=0;i<=3;i++){t.setLineDash([]),t.lineWidth=2;let s=200+i*60,l=480;q===i?t.strokeStyle="#fff":r.x>=s&&r.x<=s+50&&r.y>=l&&r.y<=l+25?t.strokeStyle="#ddd":t.strokeStyle="#0000",t.strokeRect(s,l,50,25),t.fillText(`${i===0?"0":i}`,s+27,l+11)}if(t.strokeStyle="#fff",t.lineWidth=2,t.font="40px visitor",r.x>=25+150&&r.x<=25+150+200&&r.y>=a-70&&r.y<=a-70+45&&(t.lineWidth=4,r.pressed)){const i=fe(D);history.replaceState(null,"",`?level=${i}`),le(),E=x.GAME}t.fillStyle=m.GREEN,t.fillRect(25+150,a-70,200,45),t.strokeRect(25+150,a-70,200,45),t.fillStyle="#fff",t.textAlign="center",t.fillText("play",25+150+100,a-70+20),t.lineWidth=2,t.font="40px visitor",r.x>=25+375&&r.x<=25+375+200&&r.y>=a-70&&r.y<=a-70+45&&(t.lineWidth=4,r.pressed&&(D=new Uint8Array(256).fill(255))),t.fillStyle=m.GRAY,t.fillRect(25+375,a-70,200,45),t.strokeRect(25+375,a-70,200,45),t.fillStyle="#000",t.textAlign="center",t.fillText("clear",25+100+375,a-70+20)},le=()=>{const e=new URLSearchParams(location.search);B=[],M=[],c.position={x:d/2,y:a-20};const o=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,0,0,-1,1,1,-1,2,2,-1,3,3,-1,4,4,-1],[-1,0,0,-1,1,1,-1,2,2,-1,3,3,-1,4,4,-1],[-1,0,0,-1,1,1,-1,2,2,-1,3,3,-1,4,4,-1],[-1,0,0,-1,1,1,-1,2,2,-1,3,3,-1,4,4,-1],[-1,0,0,-1,1,1,-1,2,2,-1,3,3,-1,4,4,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,5,5,-1,6,6,-1,7,7,-1,0,0,-1,1,1,-1],[-1,5,5,-1,6,6,-1,7,7,-1,0,0,-1,1,1,-1],[-1,5,5,-1,6,6,-1,7,7,-1,0,0,-1,1,1,-1],[-1,5,5,-1,6,6,-1,7,7,-1,0,0,-1,1,1,-1],[-1,5,5,-1,6,6,-1,7,7,-1,0,0,-1,1,1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]],i=e.get("level");let s=!1,l=new Uint8Array;if(i)try{l=ie(i),s=!0}catch{}if(s)for(let n=0;n<l.length;n++){if(l[n]===255)continue;const f=n%16,R=Math.floor(n/16),h=7&l[n],_=(24&l[n])>>3;ee(f,R,h,_)}else for(let n=0;n<o.length;n++)for(let f=0;f<o[n].length;f++)o[n][f]!==-1&&ee(f,n,o[n][f]);ne()},ee=(e,o,i,s)=>{const l=s??(Math.random()>.5?1:2),n={size:{x:w.x,y:w.y},position:{x:e*w.x+w.x/2,y:o*w.y+w.y/2},dead:!1,health:l,maxHealth:l,color:i,power:void 0};if(l){const f=Math.random();f<.03?n.power=y.PAD_SIZE:f<.08?n.power=y.EXTRA_BALL:f<.085?n.power=y.STICKY_PAD:f<.095?n.power=y.SHIELD:f<.1&&(n.power=y.MEGABALL)}B.push(n)},te=e=>{e.dead=!0,e.power!==void 0&&z.push({position:{x:e.position.x,y:e.position.y},size:{x:40,y:20},type:e.power})},ne=()=>{p=[],M=[],z=[],b=!1,I=null,T=!1,P=null,Y=400,G=800,c.size.x=100,p.push({radius:8,position:{x:c.position.x,y:c.position.y-c.size.y/2-8},velocity:k({x:.5,y:-1}),stuck:!0,stuckPosition:0})},Ie=()=>{u.width=d,u.height=a,window.addEventListener("keydown",function(e){U.set(e.code,!0),C.set(e.code,!0),e.code==="BracketLeft"?(S=Math.min(pe,S+1),v=F/S):e.code==="BracketRight"&&(S=Math.max(ue,S-1),v=F/S),e.code==="Enter"&&(Z=!Z),e.code==="Space"&&p.forEach(o=>o.stuck=!1),e.code==="KeyL"&&(E=x.LEVELEDITOR),e.code==="KeyG"&&(E=x.MENU)}),window.addEventListener("keyup",function(e){U.set(e.code,!1)}),window.addEventListener("mousemove",function(e){const o=u.getBoundingClientRect();r.x=e.pageX-o.left,r.y=e.pageY-o.top}),window.addEventListener("mousedown",function(){r.down=!0,r.pressed=!0}),window.addEventListener("mouseup",function(){r.down=!1})};Ie();se();function O(e){return U.get(e)??!1}
